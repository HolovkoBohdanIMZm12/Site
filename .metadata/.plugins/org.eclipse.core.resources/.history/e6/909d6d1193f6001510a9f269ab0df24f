package com.Sck;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.Socket;
import java.util.Arrays;

public class Implementation 
{
	
	/*
	   DataInputStream and DataOutputStream allows you to record and read data primitive types.
	   
	   After you create a Socket object, you can take the input and output streams of the socket. 
	   Input stream will allow you to read from the socket, 
	   and gives the output stream to write to the socket.	   
	   
	 */
	
	public void ping(Socket socket) throws IOException 
	{
		
		DataOutputStream DouS = new DataOutputStream(socket.getOutputStream());
		DataInputStream DinS = new DataInputStream(socket.getInputStream());
				
		DouS.writeInt(1);		// how many bytes we pass;
		DouS.writeByte(1);		// ID byte (records in this byte value of 1 corresponding to the ID ping command);
		
		byte array[] = new byte[DinS.readInt()]; 
		DinS.readFully(array);	// full reading from array
		
		if(array.length == 1 && array[0] == 2) 
			System.out.println("Ping success");
		else 
			System.out.println("Ping not success!!");
	}
	
	public void echo(Socket socket, String str) throws IOException 
	{
		
		DataOutputStream DouS = new DataOutputStream(socket.getOutputStream());
		DataInputStream DinS = new DataInputStream(socket.getInputStream());
		
		byte bytes_String[] = str.getBytes();
		DouS.writeInt(bytes_String.length+1);
		DouS.writeByte(3);
		DouS.write(bytes_String);
		
		byte array[] = new byte[DinS.readInt()]; 
		DinS.readFully(array);
		
		if(array.length > 1) 
		{
			String str_received = new String(array, 0, array.length);
			System.out.println(str_received);
		}
		else 
			System.out.println("Error " + array[0]);
	}
	
	public static boolean login(Socket socket, String name, String password) throws IOException, ClassNotFoundException 
	{
		DataInputStream dis = new DataInputStream(socket.getInputStream());
		DataOutputStream dos = new DataOutputStream(socket.getOutputStream());
		byte[] bytes = serialize(new String[]{name, password});
		dos.writeInt(bytes.length+1);
		dos.writeByte(5);
		dos.write(bytes);
		byte[] nbm = new byte[dis.readInt()]; 
		dis.readFully(nbm);
		 if(nbm.length == 1 && (nbm[0]==6 || nbm[0]==7)) {
			 System.out.println(nbm[0] == 6 ? "new user, registration ok" : "login ok");
			 }
		else 
			System.out.println("Error "+(nbm.length == 1 ? nbm[0] : Arrays.toString(nbm)));
		return(true); 
	}
	
	
	
	
	
	
	//==============
	
	static byte[] serialize(Object obj) throws IOException 
	{
	    ByteArrayOutputStream out = new ByteArrayOutputStream();
	    ObjectOutputStream oos = new ObjectOutputStream(out);
	    oos.writeObject(obj);
	    return out.toByteArray();
	}
	
	static Object deserialize(byte[] data) throws IOException, ClassNotFoundException 
	{
	    ByteArrayInputStream bin = new ByteArrayInputStream(data);
	    ObjectInputStream ois = new ObjectInputStream(bin);
	    return ois.readObject();
	}
	
	
}


